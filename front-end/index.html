<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post</title>
    <style>
        div {
            width: 300px;
            height: auto;
            border: 2px solid black;
            margin: 20px;
            padding: 30px;
        }
    </style>
</head>

<body>
    批量随机创建
    <div>
        <input type="number" placeholder="输入随机创建的用户数量" id="number" />
        <button type="submit" id="btn1"> 提交</button>
    </div>

    单独创建
    <div>
        <input id="username" type="text" maxlength=10 />
        <input id="password" type="password" maxlength=18>
        <button id="btn2">创建用户</button>
    </div>
    状态：
    <div>
        <p>
            <p id="result"></p>
        </p>
    </div>

    <script>
        const randomString = (len) => {
            len = len || 32;
            var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
            var maxPos = $chars.length;
            var randomString = '';
            for (i = 0; i < len; i++) {
                randomString += $chars.charAt(Math.floor(Math.random() * maxPos));
            }
            return randomString;
        }

        function postUser() {
            document.querySelector('#result').innerHTML = '';
            const number = document.querySelector('#number').value || 5;
            for (let i = 0; i < number; i++) {
                const text = randomString();
                console.log(text);
                post({ username: `${text}`, password: `pwd_${text}` }).then();
            }
        }

        function post(body) {
            if (Object.prototype.toString.call(body) !== '[object Object]') {
                throw new TypeError(`${body} is not a object to use in JSON.parse()!`);
            }
            return new Promise((res, rej) => {
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'http://49.233.132.182:3000/user', false);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
                xhr.send(JSON.stringify(body));
                if (xhr.readyState === 4) {
                    if (Math.floor(xhr.status / 200) === 1) {
                        document.querySelector('#result').innerHTML += body.username + `创建成功` + '<br/>';
                        res(xhr.response);
                    } else {
                        rej(xhr.response);
                    }
                }
            })
        }
        const btn1 = document.querySelector('#btn1');
        const btn2 = document.querySelector('#btn2');
        const username = document.querySelector('#username');
        const password = document.querySelector('#password');

        btn1.onclick = postUser;
        btn2.onclick = () => {
            document.querySelector('#result').innerHTML = '';
            post({ username: username.value, password: password.value });
        };
    </script>
</body>

</html>